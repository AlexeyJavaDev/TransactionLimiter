The microservice accepts transactions from the bank in rubles, processes them and saves them in its database.
It also stores dollar spending limits set by the user.
The microservice requests the value of the USD/RUB currency pair, stores it, and recalculates ruble transactions into dollar ones.
Transactions that exceed the dollar limit are flagged.
The user can set a limit for two different categories (service and product), request a list of all limits with exposure dates, request current limits by category, request transactions that have exceeded the limits.

Микросервис принимает транзакции от банка в рублях, обрабатывает их и сохраняет в своей базе данных.
Также хранит лимиты в долларах на расход средств, выставленные пользователем.
Микросервис запрашивает значение стоимости валютной пары УСД/РУБ, хранит его и пересчитывыет рублевые транзакции в долларовые.
Транзакции превысившие долларовый лимит помечаются.
Пользователь может установить лимит по двум разным категориям (сервис и продукт), запросить список всех лимитов с датами выставления, запросить актуальные лимиты по категориям, запросить транзакции, превысившие лимиты.

CREATE TABLE limits
(
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
setting_date TIMESTAMP WITH TIME ZONE,
account VARCHAR(10),
category VARCHAR(10),
limit_sum DOUBLE PRECISION,
limit_balance DOUBLE PRECISION
);

CREATE TABLE transactions
(
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
account_from VARCHAR(10),
account_to VARCHAR(10),
currency_shortname VARCHAR(3),
transaction_sum DOUBLE PRECISION,
expense_category VARCHAR(10),
datetime TIMESTAMP WITH TIME ZONE,
limit_exceeded BOOLEAN,
limit_id BIGINT REFERENCES limits (id)
);
CREATE TABLE currency_price
(
datetime TIMESTAMP PRIMARY KEY,
price DOUBLE PRECISION
)

Incoming transaction
POST REQUEST:
/api/bank/v1/transactions
{
"accountFromId":"0000000001",
"accountToId": "0000000002",
"transactionCurrency": "RUB",
"transactionSum": 502.45,
"expenseCategory": "product",
"transactionDate": "2023-02-21T09:48:00.860+00:00"
}

Set limit
POST REQUEST:
/api/user/v1/limits
{
"account": "0000000001",
"category": "product",
"limitSum": 1000.0
}

Get all limits by account
GET REQUEST
/api/user/v1/limits/{account}

Get actual limit for some category / all categories by account
GET REQUEST:
/api/user/v1/limits/{account}/actual?category=product/service/all

Get all limit exceeded transactions by account
GET REQUEST:
/api/user/v1/transactions/{account}